<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="High performance Java client for Apache Cassandra">
    <meta name="author" content="DataStax">

    <title>Java Driver for Apache Cassandra - Address resolution</title>

    <link rel="icon" href="../../../favicon.ico">
    <link rel="apple-touch-icon" href="../../../favicon.png">
    <link href="../../../css/style.css" rel="stylesheet">
    <link href="../../../css/pygments.css" rel="stylesheet">
    <link href="../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs" data-spy="scroll" data-target="#table-of-contents" data-offset="69">
    <header class="container-fluid navbar">
      <div class="row">
        <div class="col-sm-4">
          <a class="navbar-brand" href="../../"><img alt="Brand" src="../../../img/logo.png">Java Driver for Apache Cassandra</a>
        </div>
        <div class="col-md-4 col-md-offset-4">
          <div class="row">
            <div class="col-md-12">
              <ul class="list-inline" role="nav">
                <li><a href="https://academy.datastax.com/" class="navbar-link">DataStax Academy</a></li>
                <li><a href="http://www.datastax.com/dev/blog" class="navbar-link">Tech Blog</a></li>
                <li><a href="http://www.datastax.com/what-we-offer/products-services/support" class="navbar-link">Support</a></li>
              </ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-8">
              <form id="search" class="form-search dropdown visible-lg-block" ng-controller="search" ng-class="{open: hasResults}" role="search" ng-submit="submit()" data-spy="affix" data-offset-top="130">
                <div class="form-group has-feedback">
                  <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('2.2.0-rc1')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
                </div>
                <ul class="dropdown-menu search-results" role="menu">
                  <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
                </ul>
              </form>
            </div>
            <div class="col-md-4">
              <a href="http://www.datastax.com/download" class="btn btn-primary btn-sm">Download</a>
            </div>
          </div>
        </div>
      </div>
      <div class="row crumbs-wrapper">
        <div class="col-md-12">
          <nav id="crumbs" data-spy="affix" data-offset-top="130">
            <ol class="breadcrumb">
              
              <li>
                <div class="btn-group">
                  <button id="current-version" class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    2.2.0-rc1
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                  
                    <li><a href="../../../features/address_resolution/">3.0.0-alpha4</a></li>
                  
                    <li><a href="../../../2.2.0-rc3/features/address_resolution/">2.2.0-rc3</a></li>
                  
                    <li><a href="../../../2.2.0-rc2/features/address_resolution/">2.2.0-rc2</a></li>
                  
                    <li class="disabled"><a href="./">2.2.0-rc1</a></li>
                  
                    <li><a href="../../../2.1.9/features/address_resolution/">2.1.9</a></li>
                  
                    <li><a href="../../../2.1.8/features/address_resolution/">2.1.8</a></li>
                  
                    <li><a href="../../../2.1.7/features/address_resolution/">2.1.7</a></li>
                  
                    <li><a href="../../../2.1.6/features/address_resolution/">2.1.6</a></li>
                  
                    <li><a href="../../../2.1.5/features/address_resolution/">2.1.5</a></li>
                  
                    <li><a href="../../../2.0.12/features/address_resolution/">2.0.12</a></li>
                  
                    <li><a href="../../../2.0.11/features/address_resolution/">2.0.11</a></li>
                  
                    <li><a href="../../../2.0.10.1/features/address_resolution/">2.0.10.1</a></li>
                  
                    <li><a href="../../../2.0.10/features/address_resolution/">2.0.10</a></li>
                  
                  </ul>
                </div>
              </li>
              
              
              
              
              <li><a href="../../">Home</a></li>
              
              
              
              
              
              <li><a href="../">Features</a></li>
              
              
              
              
              
              <li class="active">Address resolution</li>
              <li class="dropdown" id="table-of-contents">
                <div class="btn-group">
                  <button id="current-section" type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                    Jump to&#8230; <span class="caret"></span><span class="sr-only">Table of Contents</span>
                  </button>
                  <ul class="dropdown-menu nav nav-pills nav-stacked">
                    <li>
<a href="#address-resolution">Address resolution
</a><ul class="nav nav-pills nav-stacked">
<li><a href="#the-address-translator-interface">The AddressTranslator interface
</a></li>
<li><a href="#ec2-multi-region">EC2 multi-region
</a></li>
</ul>
</li>
                  </ul>
                </div>
              </li>
              
              
              
            </ol>
          </nav>
        </div>
      </div>
    </header>

    <div class="container-fluid" id="content">
      <div class="row">
        <div class="col-md-3">
          <div id="navigation" class="side-nav" role="tablist" aria-multiselectable="true">
            <h3>Contents</h3>
            <ul class="nav nav-pills nav-stacked">
  
  
  
  <li><a href="../../changelog/">Changelog <small>page</small></a></li>
  
  
  
  
  <li class="active">
    <a href="../">Features <small>page</small></a>
    <ul class="nav nav-pills nav-stacked">
  
  
  
  <li class="active">
    <a href="./" class="current">Address resolution <small>page</small></a>
    
  </li>
  
  
  
  
  <li><a href="../pooling/">Connection pooling <small>page</small></a></li>
  
  
  
  
  <li><a href="../custom_payloads/">Custom Payloads <small>page</small></a></li>
  
  
  
  
  <li><a href="../logging/">Logging <small>page</small></a></li>
  
  
  
  
  <li><a href="../metadata/">Metadata <small>page</small></a></li>
  
  
  
  
  <li><a href="../native_protocol/">Native protocol <small>page</small></a></li>
  
  
  
  
  <li><a href="../paging/">Paging <small>page</small></a></li>
  
  
  
  
  <li><a href="../query_timestamps/">Query timestamps <small>page</small></a></li>
  
  
  
  
  <li><a href="../speculative_execution/">Speculative query execution <small>page</small></a></li>
  
  
  
  
  <li><a href="../shaded_jar/">Using the shaded JAR <small>page</small></a></li>
  
  
</ul>

  </li>
  
  
  
  
  <li><a href="../../faq/">Frequently Asked Questions <small>page</small></a></li>
  
  
  
  
  <li><a href="../../upgrade_guide/">Upgrade guide <small>page</small></a></li>
  
  
</ul>

          </div>
        </div>
        <div class="col-md-9 content">
          

<h2 id="address-resolution" class="target">Address resolution<a class="anchor" href="#address-resolution" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>The driver auto-detects new Cassandra nodes added to the cluster through server
side push notifications and through checking the system tables.</p>

<p>For each node, the address the driver will receive will correspond to the address set as
<code>rpc_address</code> in the node’s <code>cassandra.yaml</code> file. In most cases, this is the correct value.
However, sometimes the addresses received through this mechanism will either not be
reachable directly by the driver, or should not be the preferred address to use
(for instance, it might be a private IP, but some clients  may have to use a public IP, or
go through a router).</p>

<h3 id="the-address-translator-interface" class="target">The <a href="http://docs.datastax.com/en/drivers/java/2.2/com/datastax/driver/core/policies/AddressTranslator.html">AddressTranslator</a> interface<a class="anchor" href="#the-address-translator-interface" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p>This interface allows you to deal with such cases, by transforming the address sent by a
Cassandra node to another address to be used by the driver for connection.</p>
<pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyAddressTranslator</span> <span class="kd">implements</span> <span class="n">AddressTranslator</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">InetSocketAddress</span> <span class="n">translate</span><span class="o">(</span><span class="n">InetSocketAddress</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">...</span> <span class="c1">// your custom translation logic</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">addContactPoint</span><span class="o">(</span><span class="s">"1.2.3.4"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withAddressTranslator</span><span class="o">(</span><span class="k">new</span> <span class="n">MyAddressTranslator</span><span class="o">())</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre>
<p>Note: the contact points provided while creating the <code>Cluster</code> are not translated, only
addresses retrieved from or sent by Cassandra nodes are.</p>

<h3 id="ec2-multi-region" class="target">EC2 multi-region<a class="anchor" href="#ec2-multi-region" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h3>

<p><a href="http://docs.datastax.com/en/drivers/java/2.2/com/datastax/driver/core/policies/EC2MultiRegionAddressTranslator.html">EC2MultiRegionAddressTranslator</a> is provided out of the box. It
helps optimize network costs when your infrastructure (both Cassandra
nodes <em>and</em> clients) is distributed across multiple Amazon EC2 regions:</p>

<ul>
<li>a client communicating with a Cassandra node <em>in the same EC2 region</em> should use the node’s
private IP (which is less expensive);</li>
<li>a client communicating with a node in a different region should use the public IP.</li>
</ul>

<p>To use this implementation, provide an instance when initializing the <code>Cluster</code>:</p>
<pre class="highlight"><code><span class="n">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">addContactPoint</span><span class="o">(</span><span class="s">"1.2.3.4"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withAddressTranslator</span><span class="o">(</span><span class="k">new</span> <span class="n">EC2MultiRegionAddressTranslator</span><span class="o">())</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre>
<p>This class performs a reverse DNS lookup of the origin address, to find the domain name of the
target instance. Then it performs a forward DNS lookup of the domain name; the EC2 DNS does the
private/public switch automatically based on location.</p>


        </div>
      </div>
    </div>

    
    <footer class="container text-muted">
      <ul class="list-inline">
      
        
        <li>
          <a href="https://github.com/datastax/java-driver/">Code</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="http://datastax.github.io/java-driver/">Docs</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://datastax-oss.atlassian.net/browse/JAVA/">Issues</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://groups.google.com/a/lists.datastax.com/forum/#!forum/java-driver-user">Mailing List</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="irc://irc.freenode.net/datastax-drivers">IRC Channel</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/java-driver/releases">Releases</a>
        </li>
      
      </ul>
    </footer>
    

    <script src="../../../js/jquery.js"></script>
    <script src="../../../js/bootstrap.js"></script>
    <script src="../../../js/angular.js"></script>
    <script src="../../../js/mousetrap.js"></script>
    <script src="../../../js/hotkeys.js"></script>
    <script src="../../../js/ZeroClipboard.js"></script>
    <script src="../../../js/lunr.js"></script>
    <script src="../../../js/app.js"></script>
  </body>
</html>
